# ======================
# 基础 / Core
# ======================

# 后端服务端口（nginx 会反代到该端口）
PORT=3000

# 数据库路径（可选）
# - 本地开发（在 backend 目录启动）：默认 ./db/database.sqlite
# - Docker 镜像：默认 /app/backend/db/database.sqlite（docker-compose 已挂载 ./data -> /app/backend/db）
# DATABASE_PATH=./db/database.sqlite

# 时区与语言（可选）
# TZ=Asia/Shanghai
# APP_LOCALE=zh-CN

# JWT 密钥（用于管理员认证）
JWT_SECRET=your-jwt-secret-key-change-this-in-production

# 初始化管理员密码（可选，仅首次启动创建 admin 用户时使用）
# - 推荐在生产环境显式设置，并在首次登录后尽快修改。
# INIT_ADMIN_PASSWORD=

# CORS 允许的来源（可选，逗号/空格分隔）
# - 为空时默认仅允许本地开发端口（5173/4173）。
CORS_ORIGINS=http://localhost:5173,https://example.com

# API Key（用于油猴脚本认证）
AUTO_BOARDING_API_KEY=your-secret-api-key-here

# ======================
# OpenAI OAuth 配置（固定，不建议修改）
# ======================
OPENAI_BASE_URL=https://auth.openai.com
OPENAI_CLIENT_ID=app_EMoamEEZ73f0CkXaXp7hrann
OPENAI_REDIRECT_URI=http://localhost:1455/api/oauth/callback
OPENAI_SCOPE=openid profile email offline_access

# ======================
# 注册邮箱域名白名单（可选）
# ======================
# 推荐在后台「系统设置」配置并落库；环境变量仅作为兜底。
# 为空表示不限制；逗号分隔：example.com,.example.com
# EMAIL_DOMAIN_WHITELIST=
# 兼容旧变量名：
# ALLOWED_EMAIL_DOMAINS=

# ======================
# Cloudflare Turnstile（可选）
# ======================
# 推荐在后台「系统设置」配置并落库；环境变量仅作为兜底。
# TURNSTILE_SECRET_KEY=
# TURNSTILE_SITE_KEY=
# TURNSTILE_TIMEOUT_MS=5000
# 兼容变量名：
# CLOUDFLARE_TURNSTILE_SECRET=
# CLOUDFLARE_TURNSTILE_SITE_KEY=
# VITE_TURNSTILE_SITE_KEY=

# ======================
# SMTP 邮件（可选）
# ======================
# 推荐在后台「系统设置」配置并落库；环境变量仅作为兜底。
# SMTP_HOST=
# SMTP_PORT=465
# SMTP_SECURE=true
# SMTP_USER=
# SMTP_PASS=
# SMTP_FROM=
# ADMIN_ALERT_EMAIL=
# EMAIL_VERIFICATION_SUBJECT=邮箱验证码
# OPEN_ACCOUNTS_SWEEPER_REPORT_SUBJECT=开放账号超员扫描报告
# PURCHASE_EMAIL_SUBJECT=订单信息

# ======================
# 代理（可选）
# ======================
# 默认代理池（用于开放账号上车、人数/邀请同步、超员扫描、补偿任务等）。
# 支持 http/https/socks5/socks5h；推荐 socks5h:// 避免 DNS 污染导致证书不匹配。
# OPEN_ACCOUNTS_SWEEPER_PROXY_URLS=http://user:pass@127.0.0.1:8080, socks5h://127.0.0.1:1080
# OPEN_ACCOUNTS_SWEEPER_PROXY_URLS=
# OPEN_ACCOUNTS_SWEEPER_PROXY_FILE=

# 邀请接口代理覆盖（候车室/自动兑换邀请）
# CHATGPT_INVITE_PROXY_URLS=
# CHATGPT_INVITE_PROXY_FILE=

# 单个代理（优先级：CHATGPT_PROXY_URL -> CHATGPT_PROXY -> ALL_PROXY -> HTTPS_PROXY -> HTTP_PROXY）
# CHATGPT_PROXY_URL=
# CHATGPT_PROXY=
# ALL_PROXY=
# HTTPS_PROXY=
# HTTP_PROXY=
# （也支持小写 all_proxy / https_proxy / http_proxy）
# all_proxy=
# https_proxy=
# http_proxy=

# 邀请接口请求超时（毫秒），默认 60000
# CHATGPT_INVITE_TIMEOUT_MS=60000
# 短重试（网络抖动 / TLS 断开 / 429 / 5xx）
# CHATGPT_INVITE_RETRY_MAX_ATTEMPTS=3
# CHATGPT_INVITE_RETRY_BASE_DELAY_MS=800
# CHATGPT_INVITE_RETRY_MAX_DELAY_MS=5000

# ======================
# Telegram Bot（可选）
# ======================
# 推荐在后台「系统设置」配置并落库；环境变量仅作为兜底。
TELEGRAM_BOT_TOKEN=
# 为空时表示对所有用户开放；逗号分隔的 Telegram User ID（可通过 @userinfobot 获取）
TELEGRAM_ALLOWED_USER_IDS=
# Telegram Bot 调用本服务 API 的地址（用于 /buy、/stock 等命令）
# 默认会使用 http://127.0.0.1:${PORT}/api，你也可以显式指定为公网域名（例如 https://example.com/api）
TELEGRAM_INTERNAL_API_BASE_URL=
# Telegram Bot 调用内部 API 超时时间（毫秒），默认 12000
# TELEGRAM_INTERNAL_API_TIMEOUT_MS=12000
# /buy 下单后轮询订单状态的间隔（毫秒），默认 5000
# TELEGRAM_BUY_POLL_INTERVAL_MS=5000
# /buy 下单后轮询订单状态的超时（毫秒），默认 35 分钟
# TELEGRAM_BUY_POLL_TIMEOUT_MS=2100000

# Telegram 通知（可选，系统配置优先）
# TELEGRAM_NOTIFY_ENABLED=true
# TELEGRAM_NOTIFY_CHAT_IDS=
# TELEGRAM_NOTIFY_TIMEOUT_MS=8000

# Telegram Bot 管理员专用（需要绑定 super_admin 角色的 Telegram 账号）
# /activate <checkout_url> [activate_code] (自动激活)
# TELEGRAM_ACTIVATE_SSE_URL=http://127.0.0.1:8000/api/payments/checkout
# TELEGRAM_ACTIVATE_API_KEY=
# TELEGRAM_ACTIVATE_TIMEOUT_MS=120000
# /random_activate（随机激活账号）
# TELEGRAM_RANDOM_ACTIVATE_SSE_URL=http://127.0.0.1:8000/api/team/accounts/random/checkout/sse
# TELEGRAM_RANDOM_ACTIVATE_API_KEY=
# TELEGRAM_RANDOM_ACTIVATE_TIMEOUT_MS=120000

# ======================
# 候车室（可选）
# ======================
# 候车室容量（0 表示关闭），默认 500
# WAITING_ROOM_MAX_SIZE=500
# 允许加入队列的最低 trust_level，默认 1
# WAITING_ROOM_MIN_TRUST_LEVEL=1
# 上车后再次加入队列的冷却天数，默认 30
# WAITING_ROOM_REJOIN_COOLDOWN_DAYS=30

# 候车室自动上车（定时任务）
# 是否启用（true/false），默认 true
# WAITING_ROOM_AUTO_BOARDING_ENABLED=true
# 活跃小时（逗号分隔；支持 8-14），默认 8,9,10,11,12,13,14
# WAITING_ROOM_AUTO_BOARDING_HOURS=8-14

# ======================
# 开放账号页 / 兑换（可选）
# ======================
# 是否启用开放账号页（true/false），默认 true；关闭后 /redeem/open-accounts 将提示“平台维护中”
# OPEN_ACCOUNTS_ENABLED=true
# OPEN_ACCOUNTS_MAINTENANCE_MESSAGE=平台维护中
# 维护期间允许绕过的 Linux DO uid（逗号分隔）；用于管理员在维护期间访问/测试
# OPEN_ACCOUNTS_MAINTENANCE_ADMIN_UIDS=1
# 兑换码渠道（可选：common,linux-do），默认 linux-do（开放账号使用 Linux DO 渠道兑换码限制库存）
# OPEN_ACCOUNTS_CODE_CHANNELS=linux-do
# 仅展示最近 N 天内创建的账号（0 表示不限制），默认 30
# OPEN_ACCOUNTS_VISIBLE_CREATED_WITHIN_DAYS=30
# 订阅有效期（天），默认 30
# OPEN_ACCOUNTS_SUBSCRIPTION_DAYS=30
# 每日上车人数限制（0 表示不限制），默认 10
# OPEN_ACCOUNTS_DAILY_BOARD_LIMIT=10
# 每个用户每日上车次数限制（0 表示不限制；默认关闭；包含未完成订单占用，避免高并发超额）
# OPEN_ACCOUNTS_USER_DAILY_BOARD_LIMIT_ENABLED=true
# OPEN_ACCOUNTS_USER_DAILY_BOARD_LIMIT=1

# 开放账号超员扫描（定时任务）
# OPEN_ACCOUNTS_SWEEPER_ENABLED=true
# OPEN_ACCOUNTS_SWEEPER_INTERVAL_HOURS=2
# OPEN_ACCOUNTS_MAX_JOINED=6
# OPEN_ACCOUNTS_SWEEPER_CREATED_WITHIN_DAYS=15
# OPEN_ACCOUNTS_SWEEPER_CONCURRENCY=3
# OPEN_ACCOUNTS_SWEEPER_RUN_ON_STARTUP=false

# 订单过期清理任务（推荐开启）
# 用于定期将“已下单但未支付且超时”的订单更新为 expired，避免前台/后台长期展示无效订单。
# 过期判定窗口沿用下方的 PURCHASE_ORDER_EXPIRE_MINUTES / CREDIT_ORDER_EXPIRE_MINUTES。
# ORDER_EXPIRATION_SWEEPER_ENABLED=true
# ORDER_EXPIRATION_SWEEPER_INTERVAL_SECONDS=60
# ORDER_EXPIRATION_SWEEPER_INITIAL_DELAY_MS=30000

# Credit 订单“支付成功但执行上车失败”补偿任务（推荐开启）
# 用于定期扫描 credit_orders 中已支付但 action_status 未 fulfilled 的订单，并自动重试邀请/补写上车结果。
# 适用场景：支付成功后，ChatGPT API 网络波动 / 429 / 403(CF) 等导致邀请失败，避免人工补单。
# CREDIT_ORDER_ACTION_SWEEPER_ENABLED=true
# CREDIT_ORDER_ACTION_SWEEPER_INTERVAL_SECONDS=60
# CREDIT_ORDER_ACTION_SWEEPER_INITIAL_DELAY_MS=30000
# CREDIT_ORDER_ACTION_MAX_RETRIES=8
# CREDIT_ORDER_ACTION_RETRY_BASE_SECONDS=60
# CREDIT_ORDER_ACTION_RETRY_MAX_SECONDS=3600
# CREDIT_ORDER_ACTION_SWEEPER_CONCURRENCY=2

# 已支付上车执行短重试（推荐开启）
# 说明：Credit 订单已支付后，上车流程需调用 ChatGPT 工作空间接口发送邀请；
# 若遇到短暂网络波动/429/5xx，可在一次请求内做短重试，减少用户等待后台补偿任务的时间。
# OPEN_ACCOUNTS_BOARD_SHORT_RETRY_ENABLED=true
# OPEN_ACCOUNTS_BOARD_SHORT_RETRY_MAX_ATTEMPTS=3
# OPEN_ACCOUNTS_BOARD_SHORT_RETRY_BASE_DELAY_MS=800

# ======================
# Linux DO OAuth（可选）
# ======================
# 推荐在后台「系统设置」配置并落库；环境变量仅作为兜底。
# 使用 /redeem/linux-do / /redeem/open-accounts 前需要配置以下三项：
# LINUXDO_CLIENT_ID=
# LINUXDO_CLIENT_SECRET=
# LINUXDO_REDIRECT_URI=https://你的域名/redeem/linux-do（兑换码入口） 或者 https://你的域名/redeem/open-accounts （credit入口）
# 可选：Linux DO session token 密钥（默认复用 JWT_SECRET）
# LINUXDO_SESSION_SECRET=
# 可选：自定义 OAuth Endpoint（默认如下）
LINUXDO_AUTH_URL=https://connect.linux.do/oauth2/authorize
LINUXDO_TOKEN_URL=https://connect.linuxdo.org/oauth2/token
LINUXDO_USER_INFO_URL=https://connect.linuxdo.org/api/user

# Linux DO Credit（开放账号上车积分体系）
LINUXDO_CREDIT_BASE_URL=https://credit.linux.do/epay
# LINUXDO_CREDIT_PID=
# LINUXDO_CREDIT_KEY=
# 兼容旧变量名：
# CREDIT_BASE_URL=
# CREDIT_PID=
# CREDIT_KEY=
# LINUXDO_OPEN_ACCOUNTS_CREDIT_COST=

# Credit 网关服务端请求（可选，默认关闭）
# 说明：Credit 平台可能启用 Cloudflare challenge，服务端直连 /pay/submit.php、/api.php 容易 403；
# 推荐由前端浏览器 form POST 打开支付页，并以异步回调 notify 为准。
# CREDIT_GATEWAY_SERVER_SUBMIT_ENABLED=false
# CREDIT_GATEWAY_SERVER_QUERY_ENABLED=true
# 是否允许在后台执行 Credit 订单退款（默认 true）。若服务端被拦截导致无法退款，可先关闭并改为平台后台手动退款。
# CREDIT_GATEWAY_SERVER_REFUND_ENABLED=true

# 上车消耗积分配置
# OPEN_ACCOUNTS_CREDIT_COST=30
# OPEN_ACCOUNTS_CREDIT_TITLE=开放账号上车
# CREDIT_ORDER_EXPIRE_MINUTES=15
# CREDIT_ORDER_QUERY_MIN_INTERVAL_MS=5000

# ======================
# 支付 / 购买（可选）
# ======================
# 用于生成支付回调 notify_url 的公网域名（可选；未配置时会从请求自动推导）
# PUBLIC_BASE_URL=https://example.com

# 购买链接（用于 Telegram /buy），优先级：PURCHASE_URL > PURCHASE_LINK > PUBLIC_BASE_URL/purchase
# PURCHASE_URL=
# PURCHASE_LINK=

# 购买商品配置（不配置时会使用代码默认值）
# PURCHASE_PRODUCT_NAME=通用渠道激活码
# PURCHASE_PRICE=1.00
# PURCHASE_SERVICE_DAYS=30
# PURCHASE_ORDER_EXPIRE_MINUTES=15
# PURCHASE_NO_WARRANTY_PRICE=5.00
# PURCHASE_NO_WARRANTY_SERVICE_DAYS=30
# PURCHASE_NO_WARRANTY_PRODUCT_NAME=通用渠道激活码（无质保）
# PURCHASE_ANTI_BAN_PRICE=10.00
# PURCHASE_ANTI_BAN_SERVICE_DAYS=30
# PURCHASE_ANTI_BAN_PRODUCT_NAME=通用渠道激活码(防封禁)

# 订单查单节流（毫秒）
# PURCHASE_ORDER_QUERY_MIN_INTERVAL_MS=8000
# PURCHASE_ORDER_QUERY_FALLBACK_DELAY_MS=60000

# 邀请/订单积分奖励
# INVITE_ORDER_REWARD_POINTS=5
# PURCHASE_ORDER_REWARD_POINTS=3

# ======================
# 积分 / 提现（可选）
# ======================
# 团队席位 / 邀请解锁的积分成本（默认 15）
# TEAM_SEAT_COST_POINTS=15
# INVITE_UNLOCK_COST_POINTS=15

# 积分提现（积分返现）
# 说明：后台「系统设置」里保存的配置优先级更高，未保存时才会回退到这里的环境变量。
# WITHDRAW_RATE_POINTS=1
# WITHDRAW_RATE_CASH_CENTS=100
# WITHDRAW_MIN_CASH_CENTS=1000
# WITHDRAW_MIN_POINTS=10
# WITHDRAW_STEP_POINTS=1
# WITHDRAW_MAX_POINTS_PER_REQUEST=500
# WITHDRAW_DAILY_MAX_POINTS=500
# WITHDRAW_DAILY_MAX_REQUESTS=3
# WITHDRAW_MAX_PENDING=1
# WITHDRAW_COOLDOWN_SECONDS=60

# ======================
# 订单找回窗口（可选）
# ======================
# 订单找回 / 兑换的可追溯天数窗口，默认 30（最大 90）
# ACCOUNT_RECOVERY_WINDOW_DAYS=30

# ======================
# ZPAY（可选）
# ======================
# 推荐在后台「系统设置」配置并落库；环境变量仅作为兜底。
# ZPAY_BASE_URL=https://zpayz.cn
# ZPAY_PID=
# ZPAY_KEY=

# ======================
# 小红书 / 闲鱼定时任务（可选）
# ======================
# 小红书自动同步调度开关与轮询间隔（秒），默认 true / 60
# XHS_AUTO_SYNC_SCHEDULER_ENABLED=true
# XHS_AUTO_SYNC_CHECK_INTERVAL_SECONDS=60

# 闲鱼 cookies 自动续期调度开关与间隔（分钟），默认 true / 30
# XIANYU_LOGIN_REFRESH_ENABLED=true
# XIANYU_LOGIN_REFRESH_INTERVAL_MINUTES=30

# 闲鱼 WebSocket 订单监听 + 自动 IM 发货（可选）
# - 需要先在后台配置闲鱼 Cookie
# - 开启后会在收到“待发货”订单状态消息时，自动给买家发送发货指引
# XIANYU_WS_DELIVERY_ENABLED=false
# XIANYU_WS_DELIVERY_MESSAGE=请访问网页输入邮箱和订单号进行自助激活：https://example.com/redeem/xianyu
# XIANYU_WS_DELIVERY_DEBUG=false
# 仅调试：开启后不会真正发 IM，只打印日志
# XIANYU_WS_DELIVERY_DRY_RUN=false
# 仅调试：打印 WebSocket 收到的原始消息（可能很长）
# XIANYU_WS_DELIVERY_LOG_RAW_MESSAGES=false
# XIANYU_WS_DELIVERY_LOG_RAW_LIMIT=20
# XIANYU_WS_DELIVERY_LOG_RAW_MAXLEN=800
# WebSocket 收单轮询（秒）；部分环境下服务端不会主动 push，需要主动发 /r/SyncStatus/ackDiff 拉取
# 0 表示关闭；默认 60
# XIANYU_WS_DELIVERY_SYNC_POLL_INTERVAL_SECONDS=60
# 同步游标 pts（微秒）；默认会用当前时间；仅当设置为 >0 的数值时生效
# XIANYU_WS_DELIVERY_SYNC_PTS=0
# 备用方案：通过 MessageManager/listUserMessages 主动拉取会话消息（需要提供 chatId）
# - chatId 例如：57711559251（不要带 @goofish 也可）
# XIANYU_WS_DELIVERY_MESSAGES_POLL_CHAT_IDS=
# XIANYU_WS_DELIVERY_MESSAGES_POLL_INTERVAL_SECONDS=20
# XIANYU_WS_DELIVERY_MESSAGES_POLL_LIMIT=20
