# 开放账号（含 Credit 订单）功能启用指南

本功能包含：
- 用户侧「开放账号页」：`/redeem/open-accounts`（基于 Linux DO OAuth）
- Credit 订单相关接口与后台管理：`/admin/credit-orders`

> 约定：**Credit 订单归属于开放账号功能**（禁用开放账号即禁用 Credit 订单相关能力）。

## 1) 开启功能开关

- 进入管理后台：`/admin/settings`
- 在「功能开关」中启用「开放账号（含 Credit 订单）」

禁用时相关页面与接口会返回 `403`（`FEATURE_DISABLED`）。

## 2) 配置 Linux DO OAuth

推荐在管理后台配置并入库：
- 进入：`/admin/settings` →「Linux DO OAuth 配置」
- 填写：
  - `LINUXDO_CLIENT_ID`
  - `LINUXDO_CLIENT_SECRET`
  - `LINUXDO_REDIRECT_URI`

## 3) 配置 Linux DO Credit（积分体系）

推荐在管理后台配置并入库：
- 进入：`/admin/settings` →「Linux DO Credit 配置」
- 填写：
  - `LINUXDO_CREDIT_PID`
  - `LINUXDO_CREDIT_KEY`

可选环境变量（见 `backend/.env.example`）：
- `LINUXDO_CREDIT_BASE_URL`（默认 `https://credit.linux.do/epay`）

## 4) 可选：维护模式与业务参数

维护模式（环境变量）：
- `OPEN_ACCOUNTS_ENABLED`：默认 `true`（关闭会提示维护中）
- `OPEN_ACCOUNTS_MAINTENANCE_MESSAGE`

常用业务参数（环境变量，见 `backend/.env.example`）：
- `OPEN_ACCOUNTS_CREDIT_COST`、`OPEN_ACCOUNTS_DAILY_BOARD_LIMIT`
- `OPEN_ACCOUNTS_USER_DAILY_BOARD_LIMIT_ENABLED`、`OPEN_ACCOUNTS_USER_DAILY_BOARD_LIMIT`（每用户每日上车次数限制）
- `CREDIT_ORDER_EXPIRE_MINUTES`、`CREDIT_ORDER_QUERY_MIN_INTERVAL_MS`
- `CREDIT_GATEWAY_SERVER_*`（是否允许服务端查单/退款等）

## 5) 验证

- 访问：`/redeem/open-accounts`
- 完成 Linux DO 授权
- 按页面提示完成下单/上车流程
- 在管理后台查看 Credit 订单：`/admin/credit-orders`
